<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pretest: Persamaan & Pertidaksamaan Satu Variabel (Kelas 8)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f172a;        /* slate-900 */
      --card:#111827;      /* gray-900 */
      --card-2:#0b1220;    /* deeper */
      --text:#f8fafc;      /* slate-50 */
      --muted:#cbd5e1;     /* slate-300 */
      --brand:#22c55e;     /* green-500 */
      --brand-2:#10b981;   /* emerald-500 */
      --accent:#38bdf8;    /* sky-400 */
      --danger:#ef4444;    /* red-500 */
      --warning:#f59e0b;   /* amber-500 */
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:linear-gradient(160deg,var(--bg),#030712);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .container{max-width:960px;margin:32px auto;padding:16px}
    .card{background:linear-gradient(145deg,var(--card),var(--card-2));border:1px solid rgba(255,255,255,.06);border-radius:20px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 8px;font-size:clamp(20px,4vw,32px);font-weight:800;letter-spacing:.2px}
    p.lead{margin-top:0;color:var(--muted)}
    .grid{display:grid;gap:16px}
    @media(min-width:880px){.grid{grid-template-columns:1.2fr 1fr}}

    .field{display:grid;gap:6px;margin-bottom:10px}
    label{font-weight:600}
    input[type=text],select{background:#0b1220;border:1px solid rgba(255,255,255,.08);color:var(--text);padding:12px 14px;border-radius:12px;outline:none}
    input[type=text]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(56,189,248,.18)}

    .question{padding:18px;border:1px solid rgba(255,255,255,.08);border-radius:16px;background:rgba(2,6,23,.55)}
    .q-title{font-weight:700;margin-bottom:8px}
    .options{display:grid;gap:8px}
    .option{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;border:1px solid rgba(255,255,255,.06);border-radius:12px;cursor:pointer}
    .option:hover{border-color:var(--accent)}
    .option input{margin-top:2px}

    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
    button{border:0;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#062e15}
    .btn-secondary{background:#0b1220;color:var(--text);border:1px solid rgba(255,255,255,.1)}
    .btn-danger{background:var(--danger);color:white}

    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700;background:rgba(56,189,248,.15);color:#e0f2fe;border:1px solid rgba(56,189,248,.35)}

    .result{margin-top:16px;padding:14px;border:1px dashed rgba(255,255,255,.2);border-radius:12px;background:rgba(16,185,129,.12)}
    .result.error{background:rgba(239,68,68,.15)}
    .result small{color:var(--muted)}

    .footer{margin-top:24px;color:var(--muted);font-size:12px}
    .hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);margin:16px 0}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Test Awal: Persamaan & Pertidaksamaan Satu Variabel</h1>
      <p class="lead">Kelas 8 SMP • 10 soal pilihan ganda • <span class="badge" id="status-badge">Mode Offline</span></p>

      <div class="grid">
        <!-- Panel Identitas -->
        <section>
          <h2 style="margin-top:0">Identitas Peserta</h2>
          <div class="field">
            <label for="nama">Nama Lengkap</label>
            <input id="nama" type="text" placeholder="cth: Budi Santoso" autocomplete="name" />
          </div>
          <div class="field">
            <label for="kelas">Kelas</label>
            <input id="kelas" type="text" placeholder="cth: 8A / VIII-1" />
          </div>
          <div class="field">
            <label for="sekolah">Sekolah</label>
            <input id="sekolah" type="text" placeholder="cth: SMP Negeri 1 Bandung" />
          </div>
          <div class="actions">
            <button id="btnMulai" class="btn-secondary" type="button">Mulai Mengerjakan</button>
            <button id="btnReset" class="btn-danger" type="button" title="Kosongkan isian dan jawaban">Reset</button>
          </div>
          <div id="info" class="result" style="display:none"></div>
        </section>

        <!-- Panel Soal -->
        <section>
          <h2 style="margin-top:0">Soal (10)</h2>
          <form id="quizForm">
            <!-- Soal akan dirender via JS agar mudah diubah -->
            <div id="soalWrap" class="grid" style="grid-template-columns:1fr;gap:12px"></div>
            <div class="hr"></div>
            <div class="actions">
              <button id="btnKumpul" class="btn-primary" type="submit">Kumpulkan Jawaban</button>
              <button id="btnCek" class="btn-secondary" type="button" title="Cek skor tanpa mengirim ke database">Cek Skor Saja</button>
            </div>
          </form>
          <div id="hasil" class="result" style="display:none"></div>
        </section>
      </div>

      <div class="footer">
        <div>Catatan: Pastikan koneksi internet aktif dan konfigurasi Firebase sudah diisi.</div>
      </div>
    </div>
  </div>

  <!-- Firebase v9 Modular (CDN). Ganti config di bawah dengan milik Anda. -->
  <script type="module">
    // =====================
    // 1) KONFIGURASI FIREBASE
    // =====================
    // PENTING: Ganti nilai pada firebaseConfig dengan kredensial proyek Anda
    // (Settings -> Project settings -> Your apps -> SDK setup and configuration -> CDN)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCbnGzTwSMARR0hbWfL2oAkpGzOtSWofxk",
      authDomain: "elkpd-smp.firebaseapp.com",
      databaseURL: "https://elkpd-smp-default-rtdb.firebaseio.com",
      projectId: "elkpd-smp",
      storageBucket: "elkpd-smp.firebasestorage.app",
      messagingSenderId: "490350982670",
      appId: "1:490350982670:web:d2019da1382765d23a2e5f",
      measurementId: "G-P7F70Q08X1"
    };

    let app, db, online = false;
    try{
      app = initializeApp(firebaseConfig);
      db = getDatabase(app);
      online = true;
      document.getElementById('status-badge').textContent = 'Terhubung Firebase';
      document.getElementById('status-badge').style.background = 'rgba(34,197,94,.18)';
      document.getElementById('status-badge').style.color = '#bbf7d0';
      document.getElementById('status-badge').style.border = '1px solid rgba(34,197,94,.35)';
    }catch(err){
      console.warn('Firebase belum dikonfigurasi/terhubung:', err?.message || err);
    }

    // =====================
    // 2) BANK SOAL
    // =====================
    const bankSoal = [
      {
        id: 1,
        teks: "Nilai x yang memenuhi 3x + 5 = 20 adalah …",
        opsi: ["3","5","7","10"],
        kunci: 1 // 0-based index -> "5"
      },
      {
        id: 2,
        teks: "Penyelesaian dari 2x − 7 = 9 adalah x = …",
        opsi: ["6","7","8","9"],
        kunci: 2 // 8
      },
      {
        id: 3,
        teks: "Jika x/4 + 2 = 6, maka x = …",
        opsi: ["8","12","16","20"],
        kunci: 2 // 16
      },
      {
        id: 4,
        teks: "5(x − 2) = 20. Nilai x adalah …",
        opsi: ["4","5","6","8"],
        kunci: 2 // 6
      },
      {
        id: 5,
        teks: "Pertidaksamaan 3x + 2 ≤ 14 memiliki himpunan penyelesaian …",
        opsi: ["x ≤ 4","x < 4","x ≥ 4","x > 4"],
        kunci: 0 // x ≤ 4
      },
      {
        id: 6,
        teks: "Penyelesaian 2x − 5 > 7 adalah …",
        opsi: ["x > 5","x > 6","x ≥ 6","x ≥ 7"],
        kunci: 1 // x > 6
      },
      {
        id: 7,
        teks: "−3x + 9 ≥ 0. Himpunan penyelesaian adalah …",
        opsi: ["x ≥ 3","x ≤ 3","x < −3","x > −3"],
        kunci: 1 // x ≤ 3 (ingat membagi dengan bilangan negatif membalik tanda)
      },
      {
        id: 8,
        teks: "4 + x/2 < 10. Maka x …",
        opsi: ["< 8","< 10","< 12","> 12"],
        kunci: 2 // x < 12
      },
      {
        id: 9,
        teks: "7 − 2x ≤ 1. Maka x …",
        opsi: ["≤ 2","≥ 2","≥ 3","≤ 3"],
        kunci: 2 // x ≥ 3
      },
      {
        id: 10,
        teks: "5x + 15 = 2x + 30. Nilai x = …",
        opsi: ["3","4","5","6"],
        kunci: 2 // 5
      }
    ];

    // =====================
    // 3) RENDER SOAL
    // =====================
    const wrap = document.getElementById('soalWrap');
    function renderSoal(){
      wrap.innerHTML = '';
      bankSoal.forEach((q, idx) => {
        const card = document.createElement('div');
        card.className = 'question';
        card.innerHTML = `
          <div class="q-title">${idx+1}. ${q.teks}</div>
          <div class="options">
            ${q.opsi.map((o,i) => `
              <label class="option">
                <input type="radio" name="q${q.id}" value="${i}" />
                <div><strong>${String.fromCharCode(65+i)}.</strong> ${o}</div>
              </label>
            `).join('')}
          </div>
        `;
        wrap.appendChild(card);
      });
    }
    renderSoal();

    // =====================
    // 4) UTILITAS & VALIDASI
    // =====================
    const elNama = document.getElementById('nama');
    const elKelas = document.getElementById('kelas');
    const elSekolah = document.getElementById('sekolah');
    const elInfo = document.getElementById('info');
    const elHasil = document.getElementById('hasil');
    const btnMulai = document.getElementById('btnMulai');
    const btnReset = document.getElementById('btnReset');
    const btnCek = document.getElementById('btnCek');
    const form = document.getElementById('quizForm');

    let mulaiAt = null;

    function showInfo(msg, type='ok'){
      elInfo.style.display = 'block';
      elInfo.textContent = msg;
      elInfo.className = 'result' + (type==='error' ? ' error' : '');
    }
    function showHasil(html, type='ok'){
      elHasil.style.display = 'block';
      elHasil.innerHTML = html;
      elHasil.className = 'result' + (type==='error' ? ' error' : '');
    }
    function clearMessages(){
      elInfo.style.display = 'none';
      elHasil.style.display = 'none';
    }

    function getJawabanPengguna(){
      const jawaban = {};
      bankSoal.forEach(q => {
        const sel = /** @type {HTMLInputElement|null} */ (document.querySelector(`input[name="q${q.id}"]:checked`));
        jawaban[q.id] = sel ? Number(sel.value) : null;
      });
      return jawaban;
    }

    function hitungSkor(jawaban){
      let benar=0, salah=0, kosong=0;
      const detail = bankSoal.map(q => {
        const j = jawaban[q.id];
        const correct = j === q.kunci;
        if(j === null){kosong++;}
        else if(correct){benar++;} else {salah++;}
        return { id:q.id, benar:correct, kunci:q.kunci, jawab:j };
      });
      const skor = Math.round((benar / bankSoal.length) * 100);
      return { benar, salah, kosong, skor, detail };
    }

    function validateIdentitas(){
      if(!elNama.value.trim() || !elKelas.value.trim() || !elSekolah.value.trim()){
        showInfo('Lengkapi Nama, Kelas, dan Sekolah terlebih dahulu.', 'error');
        return false;
      }
      return true;
    }

    // =====================
    // 5) INTERAKSI TOMBOL
    // =====================
    btnMulai.addEventListener('click', () => {
      if(!validateIdentitas()) return;
      mulaiAt = new Date().toISOString();
      clearMessages();
      showInfo('Selamat mengerjakan! Setelah selesai, tekan "Kumpulkan Jawaban".', 'ok');
    });

    btnReset.addEventListener('click', () => {
      form.reset();
      elNama.value = '';
      elKelas.value = '';
      elSekolah.value = '';
      mulaiAt = null;
      clearMessages();
    });

    btnCek.addEventListener('click', () => {
      const jawaban = getJawabanPengguna();
      const { benar, salah, kosong, skor } = hitungSkor(jawaban);
      showHasil(`<strong>Skor sementara: ${skor}</strong> (Benar: ${benar}, Salah: ${salah}, Kosong: ${kosong})<br><small>Catatan: Ini hanya cek lokal, belum disimpan ke database.</small>`);
    });

    // Submit & Simpan ke Firebase
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearMessages();

      if(!validateIdentitas()) return;

      const jawaban = getJawabanPengguna();
      const belumDijawab = Object.values(jawaban).some(v => v === null);
      if(belumDijawab){
        showHasil('Masih ada soal yang belum dijawab. Silakan cek kembali.', 'error');
        return;
      }

      const result = hitungSkor(jawaban);
      const payload = {
        identitas: {
          nama: elNama.value.trim(),
          kelas: elKelas.value.trim(),
          sekolah: elSekolah.value.trim(),
        },
        meta: {
          mulaiAt: mulaiAt || null,
          selesaiAt: new Date().toISOString(),
          device: navigator.userAgent,
        },
        hasil: {
          skor: result.skor,
          benar: result.benar,
          salah: result.salah,
          kosong: result.kosong,
          detail: result.detail // simpan indeks jawaban & kunci
        }
      };

      // Tampilkan hasil ke pengguna
      showHasil(`<strong>Skor Anda: ${result.skor}</strong> (Benar: ${result.benar}, Salah: ${result.salah}, Kosong: ${result.kosong})`);

      if(!online){
        showInfo('Tidak terhubung ke Firebase. Data <em>tidak</em> dikirim.', 'error');
        return;
      }

      try{
        const listRef = ref(db, 'pretest_responses');
	const newRef = push(listRef);
	await set(newRef, payload);
        showInfo('Berhasil disimpan ke Firebase Realtime Database. Terima kasih!', 'ok');
      }catch(err){
        console.error(err);
        showInfo('Gagal menyimpan ke Firebase: ' + (err?.message || err), 'error');
      }
    });
  </script>
</body>
</html>

